<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Mario Infinite Pro</title>
    <style>
        body { margin: 0; background: #222; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; color: white; font-family: 'Arial', sans-serif; }
        canvas { border: 5px solid #444; border-radius: 10px; background: linear-gradient(#1a2a6c, #b21f1f, #fdbb2d); box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        .info { margin-bottom: 10px; font-size: 20px; }
    </style>
</head>
<body>
    <div class="info">Счёт: <span id="score">0</span> | Прыжки: <span id="jumps">2</span></div>
    <canvas id="game"></canvas>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const jumpsEl = document.getElementById('jumps');

canvas.width = 500;
canvas.height = 700;

let score = 0;
let gameSpeed = 2; // Начальная скорость прокрутки
let platforms = [];
let enemies = [];

const player = {
    x: 250, y: 500,
    w: 30, h: 30,
    vy: 0, vx: 0,
    jumps: 2,
    color: '#ffcc00'
};

// Создание платформы
function createPlatform(y, width = null) {
    const w = width || Math.random() * (120 - 60) + 60;
    return {
        x: Math.random() * (canvas.width - w),
        y: y,
        w: w,
        h: 15,
        hasEnemy: Math.random() < 0.25
    };
}

// Начальный уровень
function init() {
    for(let i = 0; i < 8; i++) {
        platforms.push(createPlatform(i * 100));
    }
}

// Управление
const keys = {};
window.onkeydown = (e) => {
    keys[e.code] = true;
    if (e.code === 'ArrowUp' || e.code === 'KeyW' || e.code === 'Space') {
        if (player.jumps > 0) {
            player.vy = -12;
            player.jumps--;
        }
    }
};
window.onkeyup = (e) => keys[e.code] = false;

function update() {
    // Движение влево/вправо
    if (keys['ArrowLeft'] || keys['KeyA']) player.vx = -6;
    else if (keys['ArrowRight'] || keys['KeyD']) player.vx = 6;
    else player.vx *= 0.8;

    player.x += player.vx;
    player.vy += 0.5; // Гравитация
    player.y += player.vy;

    // Плавная прокрутка мира вниз
    platforms.forEach(p => {
        p.y += gameSpeed;
        if (p.hasEnemy) {
            // Враги привязаны к платформам
        }
    });

    // Генерация новых платформ сверху
    if (platforms[platforms.length - 1].y > 0) {
        platforms.push(createPlatform(platforms[platforms.length - 1].y - 100));
        score += 10;
        gameSpeed += 0.01; // Ускорение игры
    }

    // Удаление старых платформ
    if (platforms[0].y > canvas.height) {
        platforms.shift();
    }

    // Коллизии с платформами
    platforms.forEach(p => {
        if (player.vy > 0 && 
            player.x + player.w > p.x && 
            player.x < p.x + p.w &&
            player.y + player.h > p.y && 
            player.y + player.h < p.y + p.h + 15) {
            player.y = p.y - player.h;
            player.vy = 0;
            player.jumps = 2; // Восстанавливаем двойной прыжок
        }

        // Коллизия с врагом на платформе
        if (p.hasEnemy) {
            let ex = p.x + p.w/2 - 10;
            let ey = p.y - 20;
            if (player.x < ex + 20 && player.x + player.w > ex &&
                player.y < ey + 20 && player.y + player.h > ey) {
                reset();
            }
        }
    });

    // Границы экрана
    if (player.x < 0) player.x = canvas.width;
    if (player.x > canvas.width) player.x = 0;

    // Смерть от падения
    if (player.y > canvas.height) reset();

    scoreEl.innerText = score;
    jumpsEl.innerText = player.jumps;
}

function reset() {
    alert("Игра окончена! Счёт: " + score);
    score = 0;
    gameSpeed = 2;
    player.y = 500;
    player.vy = 0;
    platforms = [];
    init();
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Рисуем платформы
    ctx.fillStyle = '#4ade80';
    platforms.forEach(p => {
        ctx.fillRect(p.x, p.y, p.w, p.h);
        
        // Рисуем врага (злой пульсирующий квадрат)
        if (p.hasEnemy) {
            ctx.fillStyle = '#ef4444';
            let pulse = Math.sin(Date.now() / 100) * 3;
            ctx.fillRect(p.x + p.w/2 - 10, p.y - 20 - pulse, 20, 20);
            ctx.fillStyle = '#4ade80';
        }
    });

    // Рисуем игрока
    ctx.fillStyle = player.jumps === 0 ? '#60a5fa' : '#fbbf24';
    ctx.fillRect(player.x, player.y, player.w, player.h);
}

function loop() {
    update();
    draw();
    requestAnimationFrame(loop);
}

init();
loop();
</script>
</body>
</html>

